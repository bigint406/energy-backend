[toc]

## 系统层

### 能源站

#### 1.设备在线率

所有表的在线率，由rabbit服务计算并存储到mongo文档device_online_rate_hour里面，如若没有才计算

## 能效分析

### 能源站
#### 1.电锅炉热效率（每小时一个值）
$$ \eta = \frac{Q_1}{Q_2}\times100\% $$
$Q_1$ 是锅炉的总供热量，目前可获得锅炉实际出入水温度，而各流量泵的体积流量是固定的，设为$V(V=137m^3/h)$，且启动时间短，越数秒，可忽略，因此可直接计算$Q_1$。首先计算$\Delta t$内的$Q_1'$
$$ Q_1' = \sum_{i=1}^{4} CpM^i(T^i_{outlet}-T^i_{inlet}) $$
其中$i$代表锅炉编号，$Cp$为水的比热容$4.2×10^3J/(kg•℃)$，$M^i$为$\Delta t$内流经的水的质量，$\rho$为水密度$1.0×10^3kg/m^3$，$\Delta t$为时间间隔
$$ M^i = \left\{
\begin{aligned}
\rho V\Delta t, i号水泵打开 \\
0, i号水泵关闭
\end{aligned}
\right. $$

$Q_2$是锅炉总耗电量，通过功率乘以时间获得

$$Q_2 = \sum_{i=1}^{4}P^i\Delta t$$

| 数据                 | 来源 | 参数                                |
| -------------------- | ---- | ----------------------------------- |
| $T^i_{outlet}$       | opc  | server.锅炉实际出水温度i            |
| $T^i_{inlet}$        | opc  | server.锅炉实际回水温度i            |
| i号水泵开闭          | opc  | server.A泵运行i                     |
| i号水泵开闭          | opc  | server.B泵运行i（锅炉水泵一用一备） |
| i号锅炉功率采集$P^i$ | opc  | server.功率采集i（单位未知）        |

**处理方式：**

* (server.A泵运行i+server.B泵运行i)$\times$(server.锅炉实际出水温度i-server.锅炉实际回水温度i)每$\Delta t$计算一次，并进行累加，在小时末记录一次。该值$\div60\times Cp\rho V$即为$Q_1$
* server.功率采集i 每$\Delta t$采集一次并累加，在小时末乘以$\Delta t\times 60\times 1000$即为$Q_2$（目前功率单位未知，公式暂用kW）


#### 2.蓄热水箱热效率（每小时一个值）

$$ \eta = \frac{Q_1}{Q_2}\times100\% $$

$Q_1$ 是整个蓄热过程中向蓄热水箱提供的实际热量，下式中$T$分别为水箱供回水温度，$\rho 和Cp$同上

$$ Q_1=V\rho Cp(T_{inlet}-T_{outlet})\Delta t $$

$V$为水箱体积流量，为大水箱和小水箱流量之和。各水箱流量根据液位变化计算，

$$ V=\frac{\Delta h\times S}{\Delta t} $$

$S$为水箱横截面，目前根据体积除以高度算得。大水箱约为$100m^2(1055m^3/10m)$，小水箱未知。

$Q_2$是向蓄热水箱供应的最大可能能量，下式中$V$为水箱容积（大水箱$1055m^3$，小水箱未知），$\rho 和Cp$同上

$$ Q_2=V\rho Cp(T_{average.inlet}-T_{initial}) $$

$T_{average.inlet}$为该小时蓄热过程中平均入口温度，$T_{initial}$为该小时蓄热水箱的初始状态的温度

| 数据         | 来源 | 参数              |
| ------------ | ---- | ----------------- |
| $T_{inlet}$  | opc  | server.OUTPUT_T3  |
| $T_{outlet}$ | opc  | server.OUTPUT_T4  |
| 大水箱液位   | opc  | server.OUTPUT_P10 |
| 小水箱液位   | opc  | 目前没有该数据    |

**处理方式：**

* $\Delta $(server.OUTPUT_P10$\times S_大$  + 小水箱液位$\times S_小$) $\times$ (server.OUTPUT_T3 - server.OUTPUT_T4)每$\Delta t$计算一次，每小时最后累加本小时的所有该值，将结果乘以$\rho Cp$即为$Q_1$
* server.OUTPUT_T3每小时第一个值作为$T_{initial}$
* 累加每小时的server.OUTPUT_T3，最后除以累加次数作为$T_{average.inlet}$
* 每小时最后直接计算$Q_2$

#### 3.能源站系统热效率（每小时一个值）

$$ \eta = \frac{Q_1}{Q_2}\times100\% $$

$Q_1$为一次供热管网总供热量，$Q_2$为系统总耗电量，有功电度APGL2+有功电度AZ_1为不含锅炉的总耗电量，再加上1中的$Q_2$即可。

| 数据          | 来源 | 参数                 |
| ------------- | ---- | -------------------- |
| $Q_1$         | opc  | server.RLB_累计热量  |
| 有功电度APGL2 | opc  | server.有功电度APGL2 |
| 有功电度AZ_1  | opc  | server.有功电度AZ_1  |

**处理方式：**

* 这仨都是每小时统计一次，与上一次做差（Q1单位未知）

####  4.碳排

q*系数

q单位未知，假设为kw，
